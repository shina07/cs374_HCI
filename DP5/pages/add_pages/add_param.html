<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Import CSS -->
    <link rel="stylesheet" type="text/css" href="../../lib/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../lib/bootstrap-3.3.7/js/bootstrap.min.js">
    <link rel="stylesheet" type="text/css" href="../../lib/jquery-3.2.1.min.js">
    <script type="text/javascript" src="../../lib/angular.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/main.css">
    <link rel="stylesheet" type="text/css" href="../../css/add.css">
    <link rel="stylesheet" href="../../css/workout.css">
</head>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script type="text/javascript" src="../../database/firebase.js"></script>
<script type="text/javascript" src="../../public/url.js"></script>
<script>
    //var urldict = get_url_params();
    //console.log(urldict);
    //var exercise_name = get_url_params();
    //console.log(exercise_name);
    var x = document.URL;
    var userId = (document.URL).split("=")[2];
    var exercise_name = (x.split("=")[1].split("&")[0]).split("_").join(" ");
    var d = new Date();
    var exercise_date = d.getFullYear() + "-0" + (d.getMonth()+1) + "-" + d.getDate();
    var exercise_weight = 10;
    var exercise_reps = 10;
    var exercise_sets = 0;
    //plan Id retrieval
    var planId = 0;
    var planRef = database.ref("PLANS/"+userId+"/"+exercise_date)
    planRef.once("value", function(snapshot){
        if(planId !=0){
            planId = snapshot.val().length;
        }
    })
    var set_accumulator = {};

    function weight_dec(){
        exercise_weight -= 1;
        document.getElementById("weight").innerHTML = exercise_weight;
    }
    function weight_inc(){
        exercise_weight += 1;
        document.getElementById("weight").innerHTML = exercise_weight;
    }
    function reps_dec(){
        exercise_reps -= 1;
        document.getElementById("reps").innerHTML = exercise_reps;
    }
    function reps_inc(){
        exercise_reps += 1;
        document.getElementById("reps").innerHTML = exercise_reps;
    }
    function set_addition(){
        var innerSet = {};
        exercise_sets += 1;
        innerSet['value'] = "['" + exercise_weight +"','" + exercise_reps + "']";
        innerSet['original_value'] = "['" + exercise_weight + "','" + exercise_reps + "']";
        innerSet['done'] = false;
        innerSet['changed'] = false;
        //set_accumulator += "set"+exercise_sets+":{ 'value':['" + exercise_weight +"','" + exercise_reps + "'], 'original_value:['" + exercise_weight + "','" + exercise_reps + "'], 'done': false}";
        //console.log(set_accumulator);
        set_accumulator['set'+parseInt(exercise_sets)] = innerSet;

        var inner_current = document.getElementById("sets").innerHTML;
        var inner_added = "<div class='panel-body'>Set"+ parseInt(exercise_sets) + ": ";
        inner_added += "weight: " + parseInt(exercise_weight) + " ";
        inner_added += "reps: " + parseInt(exercise_reps) + " ";
        inner_added += "</div>";
        document.getElementById("sets").innerHTML = inner_current + inner_added;
    }
    function send_plans(){
        console.log("####");
        console.log(userId);
        console.log(exercise_name);
        var planref = database.ref("PLANS/" + userId +"/" + exercise_date);
        planref.child(planId).set({
            workout_name: exercise_name,
            sets: set_accumulator
        });
        planref.once("value", function(snapshot){
            planId += 1;
        })
    }
</script>

<body>
<div id="wrap">
    <div id="header">
        <a id="back_btn" href="#">
            <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
        </a>
        <a id="home_btn" href="../main.html">
            <span>Workout Plans</span>
        </a>
        <a id="menu_btn" href="#">
            <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
        </a>
    </div>

    <div id="body_wrap">
        <!-- BODY -->
        <div class="panel panel-info" >
            <div class="panel-heading" id="exercise_name">
                <script>document.write(exercise_name);</script></div>
            <div class="panel-body">
                <div id="body_contents">
                    <div class="weight_wrap workout_edit_wrap">
                        <div class="workout_property">
                            Weight
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-info" onclick="weight_dec()">
                                <span class="glyphicon glyphicon-minus"></span>
                            </button>
                            <button id="weight" type="button" class="btn btn-default" disabled><b>
                                <script>document.write(exercise_weight);</script></b></button>
                            <button type="button" class="btn btn-info" onclick="weight_inc()">
                                <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                        <div class="workout_unit">
                            kg
                        </div>
                    </div>
                    <div class="reps_wrap workout_edit_wrap">
                        <div class="workout_property">
                            Reps
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-info" onclick="reps_dec()">
                                <span class="glyphicon glyphicon-minus"></span>
                            </button>
                            <button id="reps" type="button" class="btn btn-default" disabled><b>
                                <script>document.write(exercise_reps);</script></b></button>
                            <button type="button" class="btn btn-info" onclick="reps_inc()">
                                <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                        <div class="workout_unit">
                            times
                        </div>
                    </div>
                    <div>
                        <button type="button" class="btn btn-info add_btn" onclick="set_addition()">ADD</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-info" id="sets"></div>
        <div>
            <div class="workout_list_one"></div>
            <div class="workout_list_one"></div>
            <button type="button" class="btn btn-info confirm_btn" onclick="send_plans()">Confirm</button>
        </div>
        </div>

    </div>
</div>
    <!-- Import JavaScript -->
    <script type="text/javascript" src="../../lib/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../lib/angular.min.js"></script>
    <script type="text/javascript" src="../../js/main.js"></script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" rel="stylesheet" />

</body>
</html>